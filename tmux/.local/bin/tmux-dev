#!/bin/bash
# tmux-dev: 启动开发会话
# 用法: tmux-dev [session-name] [directory] [mode]
# mode: hx (默认, helix 2/3 + claude 1/3) | dual (双 claude 50/50)

SESSION_NAME="${1:-dev}"
WORK_DIR="${2:-$(pwd)}"
MODE="${3:-hx}"

# 如果会话已存在，直接附加
if tmux has-session -t "$SESSION_NAME" 2>/dev/null; then
    tmux attach-session -t "$SESSION_NAME"
    exit 0
fi

# 创建新会话
tmux new-session -d -s "$SESSION_NAME" -c "$WORK_DIR"

case "$MODE" in
    hx)
        # Helix 2/3 + Claude Code 1/3 (上) + Terminal (下)
        tmux split-window -h -p 33 -c "$WORK_DIR"
        tmux select-pane -L
        tmux send-keys "hx ." C-m
        tmux select-pane -R
        tmux send-keys "cl" C-m
        # 在 Claude Code 下面添加终端
        tmux split-window -v -p 30 -c "$WORK_DIR"
        tmux select-pane -U
        tmux select-pane -L
        ;;
    dual)
        # 双 Claude Code 50/50
        tmux split-window -h -c "$WORK_DIR"
        tmux select-pane -L
        tmux send-keys "cl" C-m
        tmux select-pane -R
        tmux send-keys "cl" C-m
        tmux select-pane -L
        ;;
    *)
        echo "Unknown mode: $MODE"
        echo "Available modes: hx, dual"
        exit 1
        ;;
esac

tmux attach-session -t "$SESSION_NAME"
